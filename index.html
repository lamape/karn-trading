<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XAUUSD Trading Journal üí∞</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); }
        .glass { background: rgba(255,255,255,0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .input-dark { background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.2); }
        .input-dark:focus { border-color: #fbbf24; outline: none; }
        .btn-gold { background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); }
        .btn-gold:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(251,191,36,0.3); }
        .table-row:hover { background: rgba(251,191,36,0.1); }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); }
        ::-webkit-scrollbar-thumb { background: rgba(251,191,36,0.5); border-radius: 4px; }
        .hidden { display: none !important; }
        .checkbox-item input:checked + div {
            background: #fbbf24;
            color: #000;
        }
    </style>
</head>
<body class="min-h-screen text-white">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="min-h-screen flex items-center justify-center">
        <div class="text-center">
            <div class="text-6xl mb-4 animate-bounce">üèÜ</div>
            <p class="text-gray-400">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
            <p id="loadingStatus" class="text-sm text-gray-500 mt-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î Firebase SDK...</p>
            <p id="errorStatus" class="text-sm text-red-400 mt-2 hidden"></p>
        </div>
    </div>

    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center p-4 hidden">
        <div class="glass rounded-2xl p-8 max-w-md w-full">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4">üèÜ</div>
                <h1 class="text-3xl font-bold mb-2">XAUUSD Trading Journal</h1>
                <p class="text-gray-400">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</p>
            </div>
            <form id="loginForm" class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-1">Username</label>
                    <input type="text" id="loginUsername" class="w-full input-dark rounded-lg px-4 py-3 text-white" placeholder="Enter username" required>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-1">Password</label>
                    <input type="password" id="loginPassword" class="w-full input-dark rounded-lg px-4 py-3 text-white" placeholder="Enter password" required>
                </div>
                <div id="loginError" class="text-red-400 text-sm text-center hidden">
                    Username ‡∏´‡∏£‡∏∑‡∏≠ Password ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
                </div>
                <button type="submit" id="loginBtn" class="w-full btn-gold text-black font-bold py-3 rounded-lg transition-all" disabled>
                    üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                </button>
            </form>
        </div>
    </div>

    <!-- Main App (hidden by default) -->
    <div id="mainApp" class="hidden">
        <div class="container mx-auto px-4 py-8 max-w-7xl">
            <!-- Header -->
            <div class="flex justify-between items-center mb-8">
                <div class="text-center flex-1">
                    <h1 class="text-4xl font-bold mb-2">üèÜ XAUUSD Trading Journal</h1>
                    <p class="text-gray-400">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏£‡∏î ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå ‡πÅ‡∏•‡∏∞‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ó‡∏±‡∏Å‡∏©‡∏∞</p>
                </div>
                <button onclick="logout()" class="glass px-4 py-2 rounded-lg hover:bg-red-500 hover:text-white transition-all">
                    üö™ Logout
                </button>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                <div class="glass rounded-xl p-4 text-center">
                    <div class="text-3xl mb-1">üìä</div>
                    <div class="text-2xl font-bold text-yellow-400" id="totalTrades">0</div>
                    <div class="text-sm text-gray-400">‡πÄ‡∏ó‡∏£‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                </div>
                <div class="glass rounded-xl p-4 text-center">
                    <div class="text-3xl mb-1">üéØ</div>
                    <div class="text-2xl font-bold text-green-400" id="winRate">0%</div>
                    <div class="text-sm text-gray-400">Win Rate</div>
                </div>
                <div class="glass rounded-xl p-4 text-center">
                    <div class="text-3xl mb-1">üí∞</div>
                    <div class="text-2xl font-bold" id="totalPnL">0</div>
                    <div class="text-sm text-gray-400">P&L (‡∏à‡∏∏‡∏î)</div>
                </div>
                <div class="glass rounded-xl p-4 text-center">
                    <div class="text-3xl mb-1">üìÖ</div>
                    <div class="text-2xl font-bold text-blue-400" id="todayTrades">0</div>
                    <div class="text-sm text-gray-400">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
                </div>
            </div>

            <div class="grid lg:grid-cols-2 gap-8">
                <!-- Left Column -->
                <div class="space-y-6">
                    <!-- Entry Form -->
                    <div class="glass rounded-xl p-6">
                        <h2 class="text-xl font-bold mb-4 flex items-center">
                            <span class="mr-2">üìù</span> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏£‡∏î
                        </h2>
                        <form id="tradeForm" class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm text-gray-400 mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                                    <input type="date" id="date" class="w-full input-dark rounded-lg px-4 py-2 text-white" required>
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-400 mb-1">‡πÄ‡∏ß‡∏•‡∏≤</label>
                                    <input type="time" id="time" class="w-full input-dark rounded-lg px-4 py-2 text-white" required>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm text-gray-400 mb-1">Direction</label>
                                    <select id="direction" class="w-full input-dark rounded-lg px-4 py-2 text-white" required>
                                        <option value="Long">üìà Long (‡∏ã‡∏∑‡πâ‡∏≠)</option>
                                        <option value="Short">üìâ Short (‡∏Ç‡∏≤‡∏¢)</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-400 mb-1">Result</label>
                                    <select id="result" class="w-full input-dark rounded-lg px-4 py-2 text-white" required>
                                        <option value="Win">‚úÖ Win</option>
                                        <option value="Loss">‚ùå Loss</option>
                                        <option value="BE">‚ûñ Break Even</option>
                                    </select>
                                </div>
                            </div>
                            <div class="grid grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm text-gray-400 mb-1">Entry</label>
                                    <input type="number" id="entry" step="0.01" class="w-full input-dark rounded-lg px-4 py-2 text-white" placeholder="0.00" required>
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-400 mb-1">SL</label>
                                    <input type="number" id="sl" step="0.01" class="w-full input-dark rounded-lg px-4 py-2 text-white" placeholder="0.00" required>
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-400 mb-1">TP</label>
                                    <input type="number" id="tp" step="0.01" class="w-full input-dark rounded-lg px-4 py-2 text-white" placeholder="0.00">
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm text-gray-400 mb-1">Pips (‡∏à‡∏∏‡∏î) - Auto</label>
                                <input type="number" id="pips" step="1" class="w-full input-dark rounded-lg px-4 py-2 text-white bg-gray-700" placeholder="Auto-calculate" readonly required>
                                <span class="text-xs text-gray-500">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å Direction + Result + Entry + SL/TP</span>
                            </div>

                            <!-- Timeframe -->
                            <div>
                                <label class="block text-sm text-gray-400 mb-2">Timeframe (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢)</label>
                                <div class="grid grid-cols-3 sm:grid-cols-6 gap-2">
                                    <label class="checkbox-item cursor-pointer">
                                        <input type="checkbox" name="timeframe" value="M1" class="hidden peer">
                                        <div class="text-center p-2 rounded-lg border border-gray-600 hover:bg-gray-700">M1</div>
                                    </label>
                                    <label class="checkbox-item cursor-pointer">
                                        <input type="checkbox" name="timeframe" value="M5" class="hidden peer">
                                        <div class="text-center p-2 rounded-lg border border-gray-600 hover:bg-gray-700">M5</div>
                                    </label>
                                    <label class="checkbox-item cursor-pointer">
                                        <input type="checkbox" name="timeframe" value="M15" class="hidden peer">
                                        <div class="text-center p-2 rounded-lg border border-gray-600 hover:bg-gray-700">M15</div>
                                    </label>
                                    <label class="checkbox-item cursor-pointer">
                                        <input type="checkbox" name="timeframe" value="M30" class="hidden peer">
                                        <div class="text-center p-2 rounded-lg border border-gray-600 hover:bg-gray-700">M30</div>
                                    </label>
                                    <label class="checkbox-item cursor-pointer">
                                        <input type="checkbox" name="timeframe" value="H1" class="hidden peer">
                                        <div class="text-center p-2 rounded-lg border border-gray-600 hover:bg-gray-700">H1</div>
                                    </label>
                                    <label class="checkbox-item cursor-pointer">
                                        <input type="checkbox" name="timeframe" value="H4" class="hidden peer">
                                        <div class="text-center p-2 rounded-lg border border-gray-600 hover:bg-gray-700">H4</div>
                                    </label>
                                    <label class="checkbox-item cursor-pointer">
                                        <input type="checkbox" name="timeframe" value="D1" class="hidden peer">
                                        <div class="text-center p-2 rounded-lg border border-gray-600 hover:bg-gray-700">D1</div>
                                    </label>
                                </div>
                            </div>

                            <!-- Entry Pattern / Setup -->
                            <div>
                                <label class="block text-sm text-gray-400 mb-2">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ó‡∏£‡∏î (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢)</label>
                                <div class="grid grid-cols-2 gap-2">
                                    <label class="checkbox-item cursor-pointer">
                                        <input type="checkbox" name="pattern" value="Engulfing Buy" class="hidden peer">
                                        <div class="text-center p-2 rounded-lg border border-gray-600 hover:bg-gray-700">üìà Engulfing Buy</div>
                                    </label>
                                    <label class="checkbox-item cursor-pointer">
                                        <input type="checkbox" name="pattern" value="Engulfing Sell" class="hidden peer">
                                        <div class="text-center p-2 rounded-lg border border-gray-600 hover:bg-gray-700">üìâ Engulfing Sell</div>
                                    </label>
                                    <label class="checkbox-item cursor-pointer">
                                        <input type="checkbox" name="pattern" value="Pin Bar Buy" class="hidden peer">
                                        <div class="text-center p-2 rounded-lg border border-gray-600 hover:bg-gray-700">üìà Pin Bar Buy</div>
                                    </label>
                                    <label class="checkbox-item cursor-pointer">
                                        <input type="checkbox" name="pattern" value="Pin Bar Sell" class="hidden peer">
                                        <div class="text-center p-2 rounded-lg border border-gray-600 hover:bg-gray-700">üìâ Pin Bar Sell</div>
                                    </label>
                                    <label class="checkbox-item cursor-pointer">
                                        <input type="checkbox" name="pattern" value="Breakout Buy" class="hidden peer">
                                        <div class="text-center p-2 rounded-lg border border-gray-600 hover:bg-gray-700">üìà Breakout Buy</div>
                                    </label>
                                    <label class="checkbox-item cursor-pointer">
                                        <input type="checkbox" name="pattern" value="Breakout Sell" class="hidden peer">
                                        <div class="text-center p-2 rounded-lg border border-gray-600 hover:bg-gray-700">üìâ Breakout Sell</div>
                                    </label>
                                    <label class="checkbox-item cursor-pointer">
                                        <input type="checkbox" name="pattern" value="Trend Follow Buy" class="hidden peer">
                                        <div class="text-center p-2 rounded-lg border border-gray-600 hover:bg-gray-700">üìà Trend Follow Buy</div>
                                    </label>
                                    <label class="checkbox-item cursor-pointer">
                                        <input type="checkbox" name="pattern" value="Trend Follow Sell" class="hidden peer">
                                        <div class="text-center p-2 rounded-lg border border-gray-600 hover:bg-gray-700">üìâ Trend Follow Sell</div>
                                    </label>
                                    <label class="checkbox-item cursor-pointer">
                                        <input type="checkbox" name="pattern" value="Support Buy" class="hidden peer">
                                        <div class="text-center p-2 rounded-lg border border-gray-600 hover:bg-gray-700">üìà Support Buy</div>
                                    </label>
                                    <label class="checkbox-item cursor-pointer">
                                        <input type="checkbox" name="pattern" value="Resistance Sell" class="hidden peer">
                                        <div class="text-center p-2 rounded-lg border border-gray-600 hover:bg-gray-700">üìâ Resistance Sell</div>
                                    </label>
                                    <label class="checkbox-item cursor-pointer">
                                        <input type="checkbox" name="pattern" value="Other" class="hidden peer">
                                        <div class="text-center p-2 rounded-lg border border-gray-600 hover:bg-gray-700">‚ùì ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</div>
                                    </label>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm text-gray-400 mb-1">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                                <textarea id="patternNotes" rows="2" class="w-full input-dark rounded-lg px-4 py-2 text-white" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î setup..."></textarea>
                            </div>

                            <div>
                                <label class="block text-sm text-gray-400 mb-1">‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå</label>
                                <div class="grid grid-cols-4 gap-2">
                                    <label class="cursor-pointer">
                                        <input type="radio" name="emotion" value="Happy" class="hidden peer">
                                        <div class="text-center p-2 rounded-lg border border-gray-600 peer-checked:bg-yellow-500 peer-checked:border-yellow-500 hover:bg-gray-700">üòä Happy</div>
                                    </label>
                                    <label class="cursor-pointer">
                                        <input type="radio" name="emotion" value="Focused" class="hidden peer">
                                        <div class="text-center p-2 rounded-lg border border-gray-600 peer-checked:bg-green-500 peer-checked:border-green-500 hover:bg-gray-700">üéØ Focused</div>
                                    </label>
                                    <label class="cursor-pointer">
                                        <input type="radio" name="emotion" value="Stressed" class="hidden peer">
                                        <div class="text-center p-2 rounded-lg border border-gray-600 peer-checked:bg-red-500 peer-checked:border-red-500 hover:bg-gray-700">üò∞ Stressed</div>
                                    </label>
                                    <label class="cursor-pointer">
                                        <input type="radio" name="emotion" value="Tired" class="hidden peer">
                                        <div class="text-center p-2 rounded-lg border border-gray-600 peer-checked:bg-blue-500 peer-checked:border-blue-500 hover:bg-gray-700">üò¥ Tired</div>
                                    </label>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm text-gray-400 mb-1">Checklist</label>
                                <div class="grid grid-cols-2 gap-2">
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="checkbox" id="checkEntry" class="w-4 h-4 accent-yellow-500">
                                        <span class="text-sm">Entry Signal Valid</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="checkbox" id="checkSL" class="w-4 h-4 accent-yellow-500">
                                        <span class="text-sm">SL Set</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="checkbox" id="checkTP" class="w-4 h-4 accent-yellow-500">
                                        <span class="text-sm">TP Valid</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="checkbox" id="checkRR" class="w-4 h-4 accent-yellow-500">
                                        <span class="text-sm">RR Ratio ‚â• 1:2</span>
                                    </label>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm text-gray-400 mb-1">Notes</label>
                                <textarea id="notes" rows="2" class="w-full input-dark rounded-lg px-4 py-2 text-white" placeholder="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°..."></textarea>
                            </div>
                            <button type="submit" class="w-full btn-gold text-black font-bold py-3 rounded-lg transition-all">
                                üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏£‡∏î
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Right Column -->
                <div class="space-y-6">
                    <!-- Charts -->
                    <div class="glass rounded-xl p-6">
                        <h2 class="text-xl font-bold mb-4 flex items-center">
                            <span class="mr-2">üìà</span> ‡∏Å‡∏£‡∏≤‡∏ü P&L
                        </h2>
                        <canvas id="pnlChart"></canvas>
                    </div>

                    <div class="glass rounded-xl p-6">
                        <h2 class="text-xl font-bold mb-4 flex items-center">
                            <span class="mr-2">üéØ</span> Win Rate ‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå
                        </h2>
                        <canvas id="winRateChart"></canvas>
                    </div>

                    <!-- Recent Trades -->
                    <div class="glass rounded-xl p-6">
                        <h2 class="text-xl font-bold mb-4 flex items-center">
                            <span class="mr-2">üìã</span> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (10 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)
                        </h2>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead>
                                    <tr class="text-gray-400 border-b border-gray-700">
                                        <th class="text-left py-2">‡∏ß‡∏±‡∏ô/‡πÄ‡∏ß‡∏•‡∏≤</th>
                                        <th class="text-left py-2">Dir</th>
                                        <th class="text-right py-2">Pips</th>
                                        <th class="text-center py-2">‡∏ú‡∏•</th>
                                    </tr>
                                </thead>
                                <tbody id="recentTrades">
                                    <tr><td colspan="4" class="text-center py-4 text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="mt-8 flex flex-wrap gap-4 justify-center">
                <button onclick="exportData()" class="glass px-6 py-3 rounded-lg hover:bg-yellow-500 hover:text-black transition-all">
                    üì§ Export Data (JSON)
                </button>
                <button onclick="askCoolToAnalyze()" class="btn-gold text-black px-6 py-3 rounded-lg font-bold">
                    ü§ñ Ask Cool to Analyze
                </button>
                <button onclick="clearData()" class="glass px-6 py-3 rounded-lg hover:bg-red-500 hover:text-white transition-all">
                    üóëÔ∏è Clear All Data
                </button>
            </div>

            <!-- Time Filter -->
            <div class="mt-6 flex justify-center gap-2">
                <button onclick="setTimeFilter('day')" class="time-filter glass px-4 py-2 rounded-lg hover:bg-yellow-500 hover:text-black" data-filter="day">‡∏ß‡∏±‡∏ô</button>
                <button onclick="setTimeFilter('week')" class="time-filter glass px-4 py-2 rounded-lg hover:bg-yellow-500 hover:text-black" data-filter="week">‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</button>
                <button onclick="setTimeFilter('month')" class="time-filter glass px-4 py-2 rounded-lg hover:bg-yellow-500 hover:text-black" data-filter="month">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</button>
                <button onclick="setTimeFilter('year')" class="time-filter glass px-4 py-2 rounded-lg hover:bg-yellow-500 hover:text-black" data-filter="year">‡∏õ‡∏µ</button>
                <button onclick="setTimeFilter('all')" class="time-filter glass px-4 py-2 rounded-lg bg-yellow-500 text-black" data-filter="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK from unpkg.com -->
    <script src="https://unpkg.com/firebase@10.7.1/firebase-app-compat.js"></script>
    <script src="https://unpkg.com/firebase@10.7.1/firebase-auth-compat.js"></script>
    <script src="https://unpkg.com/firebase@10.7.1/firebase-firestore-compat.js"></script>

    <script>
        // ======================
        // FIREBASE CONFIG
        // ======================
        const firebaseConfig = {
            apiKey: "AIzaSyDI7WZCjOTxVzZjc37NIiRxHD-OV_6w63Y",
            authDomain: "karn-trading-journal.firebaseapp.com",
            projectId: "karn-trading-journal",
            storageBucket: "karn-trading-journal.firebasestorage.app",
            messagingSenderId: "585098365762",
            appId: "1:585098365762:web:3e534ffbf6afe1cb5e16db",
            measurementId: "G-GZTE22DT9F"
        };

        // Initialize Firebase
        let auth = null;
        let db = null;

        function initializeFirebase() {
            console.log('üîß Initializing Firebase...');
            const loadingStatus = document.getElementById('loadingStatus');
            const errorStatus = document.getElementById('errorStatus');

            try {
                const app = firebase.initializeApp(firebaseConfig);
                auth = firebase.auth();
                db = firebase.firestore();

                console.log('‚úÖ Firebase initialized successfully');
                console.log('Auth:', auth ? 'OK' : 'FAIL');
                console.log('Firestore:', db ? 'OK' : 'FAIL');

                loadingStatus.textContent = 'Firebase ‡∏û‡∏£‡πâ‡∏≠‡∏°! ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö login...';

                setTimeout(checkLogin, 500);
            } catch (error) {
                console.error('‚ùå Firebase initialization error:', error);
                errorStatus.classList.remove('hidden');
                errorStatus.textContent = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message;
                loadingStatus.textContent = '‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î Firebase';
            }
        }

        // ======================
        // LOGIN SYSTEM
        // ======================
        const LOGIN_EMAIL = 'karn@trading.journal';
        const LOGIN_PASSWORD = 'karn14629';

        function checkLogin() {
            console.log('üîç Checking login status...');
            try {
                if (!auth || typeof auth.onAuthStateChanged !== 'function') {
                    console.error('‚ùå Auth not available');
                    setTimeout(checkLogin, 1000);
                    return;
                }

                auth.onAuthStateChanged((user) => {
                    if (user) {
                        console.log('‚úÖ User logged in:', user.email);
                        showMainApp();
                    } else {
                        console.log('üìù User not logged in');
                        showLoginScreen();
                    }
                });
            } catch (error) {
                console.error('‚ùå Check login error:', error);
            }
        }

        function showLoginScreen() {
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('loginBtn').disabled = false;
        }

        function showMainApp() {
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            loadTradesFromFirestore();
        }

        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const loginBtn = document.getElementById('loginBtn');

            if (username === 'admin' && password === LOGIN_PASSWORD) {
                try {
                    loginBtn.disabled = true;
                    loginBtn.textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...';

                    const userCredential = await auth.signInWithEmailAndPassword(LOGIN_EMAIL, LOGIN_PASSWORD);
                    console.log('‚úÖ Login successful:', userCredential.user.email);

                    loginBtn.disabled = false;
                    loginBtn.textContent = 'üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö';
                } catch (error) {
                    console.error('‚ùå Firebase login error:', error);
                    loginBtn.disabled = false;
                    loginBtn.textContent = 'üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö';

                    if (error.code === 'auth/user-not-found') {
                        alert('‚ùå User ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ Cool ‡πÄ‡∏û‡∏∑‡πà‡∏≠ setup');
                    } else if (error.code === 'auth/invalid-credential') {
                        document.getElementById('loginError').classList.remove('hidden');
                        document.getElementById('loginPassword').value = '';
                    } else {
                        alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
                    }
                }
            } else {
                document.getElementById('loginError').classList.remove('hidden');
                document.getElementById('loginPassword').value = '';
            }
        });

        window.logout = async function() {
            try {
                if (auth) {
                    await auth.signOut();
                    showLoginScreen();
                    document.getElementById('loginUsername').value = '';
                    document.getElementById('loginPassword').value = '';
                    document.getElementById('loginError').classList.add('hidden');
                }
            } catch (error) {
                console.error('‚ùå Logout error:', error);
                alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            }
        };

        // ======================
        // FIRESTORE OPERATIONS
        // ======================
        async function loadTradesFromFirestore() {
            try {
                if (!db) {
                    console.error('‚ùå Firestore not available');
                    return;
                }

                const snapshot = await db.collection('trades')
                    .orderBy('date', 'desc')
                    .orderBy('time', 'desc')
                    .get();
                trades = [];
                snapshot.forEach((doc) => {
                    trades.push({ id: doc.id, ...doc.data() });
                });
                console.log('‚úÖ Loaded', trades.length, 'trades');
                updateUI();
            } catch (error) {
                console.error('‚ùå Error loading trades:', error);
                alert('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: ' + error.message);
            }
        }

        async function saveTradeToFirestore(trade) {
            try {
                if (!db) {
                    throw new Error('Database not available');
                }

                await db.collection('trades').add(trade);
                console.log('‚úÖ Trade saved successfully');
            } catch (error) {
                console.error('‚ùå Error saving trade:', error);
                throw error;
            }
        }

        async function deleteAllTradesFromFirestore() {
            try {
                if (!db) {
                    throw new Error('Database not available');
                }

                const snapshot = await db.collection('trades').get();
                const batch = db.batch();

                snapshot.forEach((doc) => {
                    batch.delete(doc.ref);
                });

                if (snapshot.size > 0) {
                    await batch.commit();
                    console.log('‚úÖ Deleted', snapshot.size, 'trades');
                }
            } catch (error) {
                console.error('‚ùå Error deleting trades:', error);
                throw error;
            }
        }

        // ======================
        // MAIN APP LOGIC
        // ======================
        let trades = [];
        let currentTimeFilter = 'all';
        let pnlChart, winRateChart;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ DOM loaded');
            setDefaultDateTime();
            initCharts();

            // Initialize Firebase after scripts load
            setTimeout(() => {
                if (typeof firebase !== 'undefined') {
                    initializeFirebase();
                } else {
                    document.getElementById('loadingStatus').textContent = '‚ùå Firebase ‡πÇ‡∏´‡∏•‡∏î‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß!';
                    document.getElementById('errorStatus').classList.remove('hidden');
                    document.getElementById('errorStatus').textContent = 'Firebase SDK ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö';
                }
            }, 1000);
        });

        function setDefaultDateTime() {
            const now = new Date();
            const dateInput = document.getElementById('date');
            const timeInput = document.getElementById('time');
            if (dateInput && timeInput) {
                dateInput.value = now.toISOString().split('T')[0];
                timeInput.value = now.toTimeString().slice(0, 5);
            }
        }

        // Calculate Pips automatically
        function calculatePips() {
            const direction = document.getElementById('direction').value;
            const result = document.getElementById('result').value;
            const entry = parseFloat(document.getElementById('entry').value);
            const sl = parseFloat(document.getElementById('sl').value);
            const tp = parseFloat(document.getElementById('tp').value);

            const pipsInput = document.getElementById('pips');

            // Reset if any field is empty
            if (!entry || isNaN(entry)) {
                pipsInput.value = '';
                return;
            }

            let pips = 0;

            if (result === 'BE') {
                pips = 0;
            } else if (result === 'Win') {
                if (!tp || isNaN(tp)) {
                    pipsInput.value = '';
                    return;
                }
                if (direction === 'Long') {
                    pips = (tp - entry) * 100;
                } else {
                    pips = (entry - tp) * 100;
                }
            } else if (result === 'Loss') {
                if (!sl || isNaN(sl)) {
                    pipsInput.value = '';
                    return;
                }
                if (direction === 'Long') {
                    pips = (sl - entry) * 100;
                } else {
                    pips = (entry - sl) * 100;
                }
            }

            pipsInput.value = pips.toFixed(0);
        }

        // Add event listeners for auto-calculation
        document.getElementById('direction').addEventListener('change', calculatePips);
        document.getElementById('result').addEventListener('change', calculatePips);
        document.getElementById('entry').addEventListener('input', calculatePips);
        document.getElementById('sl').addEventListener('input', calculatePips);
        document.getElementById('tp').addEventListener('input', calculatePips);

        // Form Submit
        document.getElementById('tradeForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            // Get selected timeframes (multiple selection allowed)
            const timeframeCheckboxes = document.querySelectorAll('input[name="timeframe"]:checked');
            const timeframes = Array.from(timeframeCheckboxes).map(cb => cb.value);

            // Get selected patterns (multiple selection allowed)
            const patternCheckboxes = document.querySelectorAll('input[name="pattern"]:checked');
            const patterns = Array.from(patternCheckboxes).map(cb => cb.value);

            // Get selected emotion
            const emotion = document.querySelector('input[name="emotion"]:checked')?.value || 'Unknown';

            const trade = {
                date: document.getElementById('date').value,
                time: document.getElementById('time').value,
                direction: document.getElementById('direction').value,
                entry: parseFloat(document.getElementById('entry').value),
                sl: parseFloat(document.getElementById('sl').value),
                tp: parseFloat(document.getElementById('tp').value) || null,
                result: document.getElementById('result').value,
                pips: parseInt(document.getElementById('pips').value),
                timeframes: timeframes,
                patterns: patterns,
                patternNotes: document.getElementById('patternNotes').value,
                emotion: emotion,
                checklist: {
                    entryValid: document.getElementById('checkEntry').checked,
                    slValid: document.getElementById('checkSL').checked,
                    tpValid: document.getElementById('checkTP').checked,
                    rrValid: document.getElementById('checkRR').checked
                },
                notes: document.getElementById('notes').value,
                createdAt: new Date().toISOString()
            };

            try {
                await saveTradeToFirestore(trade);
                await loadTradesFromFirestore();
                alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏£‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!');
                resetForm();
            } catch (error) {
                alert('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: ' + error.message);
            }
        });

        function resetForm() {
            document.getElementById('tradeForm').reset();
            setDefaultDateTime();
        }

        function getFilteredTrades() {
            const now = new Date();
            switch(currentTimeFilter) {
                case 'day':
                    return trades.filter(t => t.date === now.toISOString().split('T')[0]);
                case 'week':
                    const weekAgo = new Date(now - 7 * 24 * 60 * 60 * 1000);
                    return trades.filter(t => new Date(t.date) >= weekAgo);
                case 'month':
                    const monthAgo = new Date(now.getFullYear(), now.getMonth(), 1);
                    return trades.filter(t => new Date(t.date) >= monthAgo);
                case 'year':
                    const yearAgo = new Date(now.getFullYear(), 0, 1);
                    return trades.filter(t => new Date(t.date) >= yearAgo);
                default:
                    return trades;
            }
        }

        function updateUI() {
            const filteredTrades = getFilteredTrades();

            // Stats
            const totalTrades = filteredTrades.length;
            const wins = filteredTrades.filter(t => t.result === 'Win').length;
            const winRate = totalTrades > 0 ? ((wins / totalTrades) * 100).toFixed(1) : 0;
            const totalPnL = filteredTrades.reduce((sum, t) => sum + t.pips, 0);
            const today = new Date().toISOString().split('T')[0];
            const todayTrades = trades.filter(t => t.date === today).length;

            document.getElementById('totalTrades').textContent = totalTrades;
            document.getElementById('winRate').textContent = winRate + '%';
            document.getElementById('totalPnL').textContent = (totalPnL >= 0 ? '+' : '') + totalPnL;
            document.getElementById('totalPnL').className = 'text-2xl font-bold ' + (totalPnL >= 0 ? 'text-green-400' : 'text-red-400');
            document.getElementById('todayTrades').textContent = todayTrades;

            // Recent trades table
            const recentTrades = filteredTrades.slice(-10).reverse();
            const tbody = document.getElementById('recentTrades');
            if (recentTrades.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="text-center py-4 text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
            } else {
                tbody.innerHTML = recentTrades.map(t => `
                    <tr class="table-row border-b border-gray-800">
                        <td class="py-2">${t.date} ${t.time}</td>
                        <td class="py-2">${t.direction === 'Long' ? 'üìà' : 'üìâ'}</td>
                        <td class="py-2 text-right ${t.pips >= 0 ? 'text-green-400' : 'text-red-400'}">${t.pips >= 0 ? '+' : ''}${t.pips}</td>
                        <td class="py-2 text-center">${t.result === 'Win' ? '‚úÖ' : t.result === 'Loss' ? '‚ùå' : '‚ûñ'}</td>
                    </tr>
                `).join('');
            }

            updateCharts(filteredTrades);
        }

        function initCharts() {
            const chartOptions = {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        labels: { color: '#fff' }
                    }
                },
                scales: {
                    x: {
                        ticks: { color: '#9ca3af' },
                        grid: { color: 'rgba(255,255,255,0.1)' }
                    },
                    y: {
                        ticks: { color: '#9ca3af' },
                        grid: { color: 'rgba(255,255,255,0.1)' }
                    }
                }
            };

            // P&L Chart
            const pnlCtx = document.getElementById('pnlChart').getContext('2d');
            pnlChart = new Chart(pnlCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'P&L (‡∏à‡∏∏‡∏î)',
                        data: [],
                        borderColor: '#fbbf24',
                        backgroundColor: 'rgba(251,191,36,0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: chartOptions
            });

            // Win Rate Chart
            const winRateCtx = document.getElementById('winRateChart').getContext('2d');
            winRateChart = new Chart(winRateCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Win Rate %',
                        data: [],
                        backgroundColor: [],
                        borderColor: [],
                        borderWidth: 1
                    }]
                },
                options: chartOptions
            });
        }

        function updateCharts(filteredTrades) {
            // P&L Chart (Cumulative)
            const sortedTrades = [...filteredTrades].sort((a, b) => {
                const dateA = new Date(a.date + 'T' + a.time);
                const dateB = new Date(b.date + 'T' + b.time);
                return dateA - dateB;
            });
            let cumulative = 0;
            const pnlData = sortedTrades.map(t => {
                cumulative += t.pips;
                return cumulative;
            });

            pnlChart.data.labels = sortedTrades.map(t => t.date.slice(5)); // MM-DD
            pnlChart.data.datasets[0].data = pnlData;
            pnlChart.update();

            // Win Rate by Week
            const weekStats = {};
            filteredTrades.forEach(t => {
                const week = getWeekNumber(t.date);
                if (!weekStats[week]) {
                    weekStats[week] = { wins: 0, total: 0 };
                }
                weekStats[week].total++;
                if (t.result === 'Win') weekStats[week].wins++;
            });

            const weeks = Object.keys(weekStats);
            const winRates = weeks.map(w => ((weekStats[w].wins / weekStats[w].total) * 100).toFixed(1));
            const colors = winRates.map(r => r >= 50 ? 'rgba(34,197,94,0.8)' : 'rgba(239,68,68,0.8)');
            const borders = winRates.map(r => r >= 50 ? 'rgba(34,197,94,1)' : 'rgba(239,68,68,1)');

            winRateChart.data.labels = weeks;
            winRateChart.data.datasets[0].data = winRates;
            winRateChart.data.datasets[0].backgroundColor = colors;
            winRateChart.data.datasets[0].borderColor = borders;
            winRateChart.update();
        }

        function getWeekNumber(dateStr) {
            const date = new Date(dateStr);
            const year = date.getFullYear();
            const week = Math.ceil((date - new Date(year, 0, 1)) / (7 * 24 * 60 * 60 * 1000));
            return `${year}-W${week}`;
        }

        window.setTimeFilter = function(filter) {
            currentTimeFilter = filter;
            document.querySelectorAll('.time-filter').forEach(btn => {
                btn.classList.remove('bg-yellow-500', 'text-black');
                if (btn.dataset.filter === filter) {
                    btn.classList.add('bg-yellow-500', 'text-black');
                }
            });
            updateUI();
        };

        window.exportData = function() {
            const data = JSON.stringify(trades, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'xauusd_trades_' + new Date().toISOString().split('T')[0] + '.json';
            a.click();
            URL.revokeObjectURL(url);
        };

        window.askCoolToAnalyze = function() {
            if (trades.length === 0) {
                alert('‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå');
                return;
            }

            const summary = `
üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏£‡∏î XAUUSD:

${getFilteredTrades().length} trades ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
Total P&L: ${trades.reduce((sum, t) => sum + t.pips, 0)} ‡∏à‡∏∏‡∏î
Win Rate: ${(trades.filter(t => t.result === 'Win').length / trades.length * 100).toFixed(1)}%

Data JSON:
${JSON.stringify(trades.slice(-20), null, 2)}

‡πÇ‡∏õ‡∏£‡∏î‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå: 1) Pattern ‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏£‡∏î 2) ‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå vs ‡∏ú‡∏• 3) ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á
            `;

            navigator.clipboard.writeText(summary).then(() => {
                alert('‚úÖ Data ‡∏ñ‡∏π‡∏Å copy ‡πÑ‡∏õ clipboard ‡πÅ‡∏•‡πâ‡∏ß!\n\n‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏ú‡∏°‡πÉ‡∏ô Telegram ‡πÅ‡∏•‡∏∞‡∏ö‡∏≠‡∏Å "‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå data ‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πà‡∏≠‡∏¢"');
            }).catch(() => {
                alert('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ copy data ‡πÑ‡∏î‡πâ ‡∏•‡∏≠‡∏á export JSON ‡πÅ‡∏ó‡∏ô');
            });
        };

        window.clearData = async function() {
            if (confirm('‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏ô‡∏µ‡πà‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ!')) {
                try {
                    await deleteAllTradesFromFirestore();
                    trades = [];
                    updateUI();
                    alert('‚úÖ ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
                } catch (error) {
                    alert('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: ' + error.message);
                }
            }
        };
    </script>
</body>
</html>
